<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Coordinate Database Tester</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="complete_coordinates_database.js"></script>
</head>
<body class="bg-gray-50 p-6">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">üóÑÔ∏è Comprehensive Station Coordinate Database Tester</h1>
        
        <!-- Database Statistics -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üìä Database Statistics</h2>
            <div id="database-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- Stats will be populated here -->
            </div>
        </div>

        <!-- City Breakdown -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üèôÔ∏è City-wise Station Breakdown</h2>
            <div id="city-breakdown" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- City stats will be populated here -->
            </div>
        </div>

        <!-- Station Type Analysis -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üèóÔ∏è Station Type Analysis</h2>
            <div id="type-analysis" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- Type analysis will be populated here -->
            </div>
        </div>

        <!-- Verification Status -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">‚úÖ Coordinate Verification Status</h2>
            <div id="verification-status" class="space-y-4">
                <!-- Verification status will be populated here -->
            </div>
        </div>

        <!-- Random Sample Testing -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üé≤ Random Sample Testing</h2>
            <button onclick="testRandomSamples()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mb-4">
                Test 10 Random Stations
            </button>
            <div id="random-test-results" class="space-y-2">
                <!-- Random test results will appear here -->
            </div>
        </div>

        <!-- Search and Test Individual Stations -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">üîç Search and Test Individual Stations</h2>
            <div class="flex gap-4 mb-4">
                <select id="city-select" class="border rounded px-3 py-2">
                    <option value="AMD">Ahmedabad (AMD)</option>
                    <option value="RJKT">Rajkot (RJKT)</option>
                    <option value="SRT">Surat (SRT)</option>
                </select>
                <input type="text" id="station-search" placeholder="Enter station name..." 
                       class="border rounded px-3 py-2 flex-1">
                <button onclick="searchStation()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Search
                </button>
            </div>
            <div id="search-results" class="mt-4">
                <!-- Search results will appear here -->
            </div>
        </div>
    </div>

    <script>
        // Initialize the database analysis
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof COMPLETE_STATION_COORDINATES === 'undefined') {
                document.body.innerHTML = '<div class="text-center text-red-600 text-xl mt-20">‚ùå Error: Coordinate database not loaded!</div>';
                return;
            }
            
            analyzeDatabase();
            populateStatistics();
        });

        function analyzeDatabase() {
            const db = COMPLETE_STATION_COORDINATES;
            
            // Overall statistics
            let totalStations = 0;
            let verifiedStations = 0;
            let unverifiedStations = 0;
            const cityStats = {};
            const typeStats = {};

            // Analyze each city
            Object.keys(db).forEach(city => {
                const stations = db[city];
                const cityStationCount = Object.keys(stations).length;
                totalStations += cityStationCount;
                
                let cityVerified = 0;
                let cityUnverified = 0;
                const cityTypes = {};

                Object.values(stations).forEach(station => {
                    if (station.verified) {
                        verifiedStations++;
                        cityVerified++;
                    } else {
                        unverifiedStations++;
                        cityUnverified++;
                    }

                    // Count station types
                    const type = station.type || 'unknown';
                    typeStats[type] = (typeStats[type] || 0) + 1;
                    cityTypes[type] = (cityTypes[type] || 0) + 1;
                });

                cityStats[city] = {
                    total: cityStationCount,
                    verified: cityVerified,
                    unverified: cityUnverified,
                    types: cityTypes
                };
            });

            // Store for global access
            window.dbAnalysis = {
                totalStations,
                verifiedStations,
                unverifiedStations,
                cityStats,
                typeStats,
                verificationRate: Math.round((verifiedStations / totalStations) * 100)
            };
        }

        function populateStatistics() {
            const analysis = window.dbAnalysis;
            
            // Overall stats
            document.getElementById('database-stats').innerHTML = `
                <div class="text-center p-4 bg-blue-50 rounded">
                    <div class="text-2xl font-bold text-blue-600">${analysis.totalStations}</div>
                    <div class="text-sm text-gray-600">Total Stations</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded">
                    <div class="text-2xl font-bold text-green-600">${analysis.verifiedStations}</div>
                    <div class="text-sm text-gray-600">Verified</div>
                </div>
                <div class="text-center p-4 bg-orange-50 rounded">
                    <div class="text-2xl font-bold text-orange-600">${analysis.unverifiedStations}</div>
                    <div class="text-sm text-gray-600">Estimated</div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded">
                    <div class="text-2xl font-bold text-purple-600">${analysis.verificationRate}%</div>
                    <div class="text-sm text-gray-600">Verification Rate</div>
                </div>
            `;

            // City breakdown
            const cityNames = { AMD: 'Ahmedabad', RJKT: 'Rajkot', SRT: 'Surat' };
            document.getElementById('city-breakdown').innerHTML = Object.keys(analysis.cityStats)
                .map(city => {
                    const stats = analysis.cityStats[city];
                    return `
                        <div class="border rounded-lg p-4">
                            <h3 class="font-semibold text-lg mb-2">${cityNames[city]} (${city})</h3>
                            <div class="space-y-1 text-sm">
                                <div>Total: <span class="font-semibold">${stats.total}</span></div>
                                <div class="text-green-600">Verified: <span class="font-semibold">${stats.verified}</span></div>
                                <div class="text-orange-600">Estimated: <span class="font-semibold">${stats.unverified}</span></div>
                                <div class="text-purple-600">Rate: <span class="font-semibold">${Math.round((stats.verified / stats.total) * 100)}%</span></div>
                            </div>
                        </div>
                    `;
                }).join('');

            // Type analysis
            const topTypes = Object.entries(analysis.typeStats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8);
            
            document.getElementById('type-analysis').innerHTML = topTypes
                .map(([type, count]) => `
                    <div class="text-center p-3 bg-gray-50 rounded">
                        <div class="text-lg font-bold text-gray-700">${count}</div>
                        <div class="text-xs text-gray-600">${type.replace(/_/g, ' ')}</div>
                    </div>
                `).join('');

            // Verification status
            document.getElementById('verification-status').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    ${Object.keys(analysis.cityStats).map(city => {
                        const stats = analysis.cityStats[city];
                        const rate = Math.round((stats.verified / stats.total) * 100);
                        const barColor = rate >= 70 ? 'bg-green-400' : rate >= 50 ? 'bg-yellow-400' : 'bg-red-400';
                        return `
                            <div class="border rounded-lg p-4">
                                <h4 class="font-semibold mb-2">${cityNames[city]}</h4>
                                <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                                    <div class="${barColor} h-4 rounded-full" style="width: ${rate}%"></div>
                                </div>
                                <div class="text-sm text-gray-600">${rate}% verified (${stats.verified}/${stats.total})</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function testRandomSamples() {
            const db = COMPLETE_STATION_COORDINATES;
            const results = [];
            
            // Get random stations from each city
            Object.keys(db).forEach(city => {
                const stations = Object.keys(db[city]);
                const randomStations = stations.sort(() => 0.5 - Math.random()).slice(0, 3);
                
                randomStations.forEach(stationName => {
                    const station = db[city][stationName];
                    results.push({
                        city,
                        name: stationName,
                        ...station
                    });
                });
            });

            // Display results
            document.getElementById('random-test-results').innerHTML = results
                .map(station => `
                    <div class="border rounded p-3 ${station.verified ? 'border-green-200 bg-green-50' : 'border-orange-200 bg-orange-50'}">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-semibold">${station.name}</div>
                                <div class="text-sm text-gray-600">${station.city} ‚Ä¢ ${station.type}</div>
                                <div class="text-xs text-gray-500">
                                    üìç ${station.lat.toFixed(6)}, ${station.lng.toFixed(6)}
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-semibold ${station.verified ? 'text-green-600' : 'text-orange-600'}">
                                    ${station.verified ? '‚úÖ Verified' : 'üìç Estimated'}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
        }

        function searchStation() {
            const city = document.getElementById('city-select').value;
            const searchTerm = document.getElementById('station-search').value.trim();
            
            if (!searchTerm) {
                document.getElementById('search-results').innerHTML = '<div class="text-red-600">Please enter a station name to search.</div>';
                return;
            }

            const db = COMPLETE_STATION_COORDINATES;
            const cityStations = db[city] || {};
            
            // Find exact match first
            if (cityStations[searchTerm]) {
                displaySearchResult(searchTerm, cityStations[searchTerm], city, 'exact');
                return;
            }

            // Find partial matches
            const matches = Object.keys(cityStations)
                .filter(name => name.toLowerCase().includes(searchTerm.toLowerCase()))
                .slice(0, 10);

            if (matches.length === 0) {
                document.getElementById('search-results').innerHTML = `
                    <div class="text-red-600">No stations found matching "${searchTerm}" in ${city}</div>
                `;
                return;
            }

            // Display all matches
            const resultsHtml = matches.map(stationName => {
                const station = cityStations[stationName];
                return `
                    <div class="border rounded p-4 mb-3 ${station.verified ? 'border-green-200 bg-green-50' : 'border-orange-200 bg-orange-50'}">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold text-lg">${stationName}</h3>
                            <span class="text-sm font-semibold ${station.verified ? 'text-green-600' : 'text-orange-600'}">
                                ${station.verified ? '‚úÖ Verified' : 'üìç Estimated'}
                            </span>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <div><strong>Type:</strong> ${station.type || 'unknown'}</div>
                                <div><strong>Coordinates:</strong> ${station.lat.toFixed(6)}, ${station.lng.toFixed(6)}</div>
                            </div>
                            <div>
                                <div><strong>City:</strong> ${city}</div>
                                <div><strong>Status:</strong> ${station.verified ? 'Verified Location' : 'Estimated Location'}</div>
                            </div>
                        </div>
                        <div class="mt-2">
                            <a href="https://www.google.com/maps?q=${station.lat},${station.lng}" 
                               target="_blank" 
                               class="text-blue-600 hover:text-blue-800 text-sm">
                                üó∫Ô∏è View on Google Maps
                            </a>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('search-results').innerHTML = `
                <div class="mb-3 text-gray-600">Found ${matches.length} station(s) matching "${searchTerm}":</div>
                ${resultsHtml}
            `;
        }

        function displaySearchResult(stationName, station, city, matchType) {
            const html = `
                <div class="border rounded p-4 ${station.verified ? 'border-green-200 bg-green-50' : 'border-orange-200 bg-orange-50'}">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-semibold text-lg">${stationName}</h3>
                        <span class="text-sm font-semibold ${station.verified ? 'text-green-600' : 'text-orange-600'}">
                            ${station.verified ? '‚úÖ Verified' : 'üìç Estimated'}
                        </span>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm mb-3">
                        <div>
                            <div><strong>Type:</strong> ${station.type || 'unknown'}</div>
                            <div><strong>Coordinates:</strong> ${station.lat.toFixed(6)}, ${station.lng.toFixed(6)}</div>
                        </div>
                        <div>
                            <div><strong>City:</strong> ${city}</div>
                            <div><strong>Match:</strong> ${matchType === 'exact' ? 'Exact Match' : 'Partial Match'}</div>
                        </div>
                    </div>
                    <a href="https://www.google.com/maps?q=${station.lat},${station.lng}" 
                       target="_blank" 
                       class="text-blue-600 hover:text-blue-800 text-sm">
                        üó∫Ô∏è View on Google Maps
                    </a>
                </div>
            `;
            document.getElementById('search-results').innerHTML = html;
        }

        // Auto-search on Enter key
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('station-search').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchStation();
                }
            });
        });
    </script>
</body>
</html>