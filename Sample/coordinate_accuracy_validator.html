<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coordinate Accuracy Validation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="corrected_coordinates_database.js"></script>
</head>
<body class="bg-gray-50 p-6">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">‚úÖ Coordinate Accuracy Validation</h1>
        
        <!-- Validation Status -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üìä Database Quality Report</h2>
            <div id="quality-report" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- Quality metrics will be populated here -->
            </div>
        </div>

        <!-- Coordinate Validation Tests -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üß™ Coordinate Validation Tests</h2>
            <button onclick="runValidationTests()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mb-4">
                Run All Validation Tests
            </button>
            <div id="validation-results" class="space-y-3">
                <!-- Validation test results will appear here -->
            </div>
        </div>

        <!-- Key Station Verification -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üéØ Key Station Verification</h2>
            <div id="key-stations" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Key station verification will be populated here -->
            </div>
        </div>

        <!-- Sample Coordinate Check -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">üîç Sample Coordinate Check</h2>
            <div class="flex gap-4 mb-4">
                <select id="sample-city" class="border rounded px-3 py-2">
                    <option value="AMD">Ahmedabad (AMD)</option>
                    <option value="RJKT">Rajkot (RJKT)</option>
                    <option value="SRT">Surat (SRT)</option>
                </select>
                <button onclick="checkRandomSample()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Check Random Sample
                </button>
            </div>
            <div id="sample-results" class="space-y-2">
                <!-- Sample check results will appear here -->
            </div>
        </div>
    </div>

    <script>
        // Initialize validation when page loads
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof COMPLETE_STATION_COORDINATES === 'undefined') {
                document.body.innerHTML = '<div class="text-center text-red-600 text-xl mt-20">‚ùå Error: Corrected coordinate database not loaded!</div>';
                return;
            }
            
            generateQualityReport();
            populateKeyStations();
        });

        function generateQualityReport() {
            const db = COMPLETE_STATION_COORDINATES;
            let totalStations = 0;
            let verifiedStations = 0;
            let estimatedStations = 0;
            let cityStats = {};

            // Analyze database quality
            Object.keys(db).forEach(city => {
                const stations = db[city];
                const cityTotal = Object.keys(stations).length;
                let cityVerified = 0;
                
                Object.values(stations).forEach(station => {
                    totalStations++;
                    if (station.verified) {
                        verifiedStations++;
                        cityVerified++;
                    } else {
                        estimatedStations++;
                    }
                });
                
                cityStats[city] = {
                    total: cityTotal,
                    verified: cityVerified,
                    rate: Math.round((cityVerified / cityTotal) * 100)
                };
            });

            const overallRate = Math.round((verifiedStations / totalStations) * 100);
            
            document.getElementById('quality-report').innerHTML = `
                <div class="text-center p-4 bg-blue-50 rounded">
                    <div class="text-2xl font-bold text-blue-600">${totalStations}</div>
                    <div class="text-sm text-gray-600">Total Stations</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded">
                    <div class="text-2xl font-bold text-green-600">${verifiedStations}</div>
                    <div class="text-sm text-gray-600">Research Verified</div>
                </div>
                <div class="text-center p-4 bg-orange-50 rounded">
                    <div class="text-2xl font-bold text-orange-600">${estimatedStations}</div>
                    <div class="text-sm text-gray-600">Estimated</div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded">
                    <div class="text-2xl font-bold text-purple-600">${overallRate}%</div>
                    <div class="text-sm text-gray-600">Accuracy Rate</div>
                </div>
            `;
        }

        function runValidationTests() {
            const results = [];
            const db = COMPLETE_STATION_COORDINATES;
            
            // Test 1: Check coordinate bounds
            results.push(validateCoordinateBounds(db));
            
            // Test 2: Check for duplicate coordinates
            results.push(validateNoDuplicates(db));
            
            // Test 3: Verify major stations have verified coordinates
            results.push(validateMajorStations(db));
            
            // Test 4: Check coordinate precision
            results.push(validateCoordinatePrecision(db));
            
            displayValidationResults(results);
        }

        function validateCoordinateBounds(db) {
            const bounds = {
                'AMD': { minLat: 22.8, maxLat: 23.3, minLng: 72.3, maxLng: 72.8 },
                'RJKT': { minLat: 22.2, maxLat: 22.4, minLng: 70.6, maxLng: 70.9 },
                'SRT': { minLat: 21.0, maxLat: 21.4, minLng: 72.6, maxLng: 73.0 }
            };
            
            let totalChecked = 0;
            let validBounds = 0;
            let invalidStations = [];
            
            Object.keys(db).forEach(city => {
                const cityBounds = bounds[city];
                Object.keys(db[city]).forEach(stationName => {
                    const station = db[city][stationName];
                    totalChecked++;
                    
                    if (station.lat >= cityBounds.minLat && station.lat <= cityBounds.maxLat &&
                        station.lng >= cityBounds.minLng && station.lng <= cityBounds.maxLng) {
                        validBounds++;
                    } else {
                        invalidStations.push({ city, station: stationName, coords: [station.lat, station.lng] });
                    }
                });
            });
            
            return {
                test: 'Coordinate Bounds Validation',
                passed: invalidStations.length === 0,
                details: `${validBounds}/${totalChecked} stations within valid bounds`,
                issues: invalidStations.slice(0, 5) // Show max 5 issues
            };
        }

        function validateNoDuplicates(db) {
            const coordMap = new Map();
            let duplicates = [];
            
            Object.keys(db).forEach(city => {
                Object.keys(db[city]).forEach(stationName => {
                    const station = db[city][stationName];
                    const coordKey = `${station.lat.toFixed(4)},${station.lng.toFixed(4)}`;
                    
                    if (coordMap.has(coordKey)) {
                        duplicates.push({
                            stations: [coordMap.get(coordKey), `${city}:${stationName}`],
                            coords: [station.lat, station.lng]
                        });
                    } else {
                        coordMap.set(coordKey, `${city}:${stationName}`);
                    }
                });
            });
            
            return {
                test: 'Duplicate Coordinates Check',
                passed: duplicates.length === 0,
                details: `${duplicates.length} duplicate coordinate pairs found`,
                issues: duplicates.slice(0, 5)
            };
        }

        function validateMajorStations(db) {
            const majorStations = {
                'AMD': ['Lal Darwaja', 'Sabarmati Railway Station', 'Gujarat University', 'ISKCON Temple'],
                'RJKT': ['Trikon Baug', 'Rajkot Junction', 'Saurashtra University'],
                'SRT': ['Surat Railway Station', 'Diamond Market', 'ADAJAN GSRTC']
            };
            
            let totalMajor = 0;
            let verifiedMajor = 0;
            let unverifiedMajor = [];
            
            Object.keys(majorStations).forEach(city => {
                majorStations[city].forEach(stationName => {
                    totalMajor++;
                    if (db[city] && db[city][stationName] && db[city][stationName].verified) {
                        verifiedMajor++;
                    } else {
                        unverifiedMajor.push(`${city}:${stationName}`);
                    }
                });
            });
            
            return {
                test: 'Major Stations Verification',
                passed: unverifiedMajor.length === 0,
                details: `${verifiedMajor}/${totalMajor} major stations verified`,
                issues: unverifiedMajor
            };
        }

        function validateCoordinatePrecision(db) {
            let totalStations = 0;
            let precisionsIssues = [];
            
            Object.keys(db).forEach(city => {
                Object.keys(db[city]).forEach(stationName => {
                    const station = db[city][stationName];
                    totalStations++;
                    
                    // Check if coordinates have reasonable precision (4+ decimal places)
                    const latPrecision = (station.lat.toString().split('.')[1] || '').length;
                    const lngPrecision = (station.lng.toString().split('.')[1] || '').length;
                    
                    if (latPrecision < 4 || lngPrecision < 4) {
                        precisionsIssues.push({
                            station: `${city}:${stationName}`,
                            precision: `${latPrecision},${lngPrecision}`,
                            coords: [station.lat, station.lng]
                        });
                    }
                });
            });
            
            return {
                test: 'Coordinate Precision Check',
                passed: precisionsIssues.length < totalStations * 0.1, // Allow 10% with lower precision
                details: `${precisionsIssues.length}/${totalStations} stations with low precision`,
                issues: precisionsIssues.slice(0, 5)
            };
        }

        function displayValidationResults(results) {
            const html = results.map(result => `
                <div class="border rounded p-4 ${result.passed ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'}">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-semibold ${result.passed ? 'text-green-800' : 'text-red-800'}">${result.test}</h3>
                        <span class="text-sm font-semibold ${result.passed ? 'text-green-600' : 'text-red-600'}">
                            ${result.passed ? '‚úÖ PASSED' : '‚ùå FAILED'}
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${result.details}</p>
                    ${result.issues && result.issues.length > 0 ? `
                        <div class="text-xs text-gray-500">
                            <strong>Issues:</strong> ${JSON.stringify(result.issues, null, 2)}
                        </div>
                    ` : ''}
                </div>
            `).join('');
            
            document.getElementById('validation-results').innerHTML = html;
        }

        function populateKeyStations() {
            const keyStations = [
                { city: 'AMD', name: 'Lal Darwaja', type: 'major_hub' },
                { city: 'AMD', name: 'ISKCON Temple', type: 'religious' },
                { city: 'AMD', name: 'Gujarat University', type: 'educational' },
                { city: 'RJKT', name: 'Trikon Baug', type: 'major_hub' },
                { city: 'RJKT', name: 'Rajkot Junction', type: 'railway_station' },
                { city: 'SRT', name: 'Surat Railway Station', type: 'railway_station' },
                { city: 'SRT', name: 'Diamond Market', type: 'commercial' }
            ];

            const db = COMPLETE_STATION_COORDINATES;
            const html = keyStations.map(key => {
                const station = db[key.city] && db[key.city][key.name];
                if (!station) return '';
                
                return `
                    <div class="border rounded p-4 ${station.verified ? 'border-green-200 bg-green-50' : 'border-orange-200 bg-orange-50'}">
                        <h3 class="font-semibold">${key.name}</h3>
                        <div class="text-sm text-gray-600">${key.city} ‚Ä¢ ${key.type}</div>
                        <div class="text-xs text-gray-500 mt-1">
                            üìç ${station.lat.toFixed(6)}, ${station.lng.toFixed(6)}
                        </div>
                        <div class="text-xs mt-2 ${station.verified ? 'text-green-600' : 'text-orange-600'}">
                            ${station.verified ? '‚úÖ Research Verified' : 'üìç Estimated'}
                        </div>
                        <a href="https://www.google.com/maps?q=${station.lat},${station.lng}" 
                           target="_blank" 
                           class="text-blue-600 hover:text-blue-800 text-xs">
                            üó∫Ô∏è Verify on Google Maps
                        </a>
                    </div>
                `;
            }).join('');
            
            document.getElementById('key-stations').innerHTML = html;
        }

        function checkRandomSample() {
            const city = document.getElementById('sample-city').value;
            const db = COMPLETE_STATION_COORDINATES;
            const stations = Object.keys(db[city] || {});
            
            if (stations.length === 0) {
                document.getElementById('sample-results').innerHTML = '<div class="text-red-600">No stations found for selected city.</div>';
                return;
            }
            
            // Get 5 random stations
            const randomStations = stations.sort(() => 0.5 - Math.random()).slice(0, 5);
            
            const html = randomStations.map(stationName => {
                const station = db[city][stationName];
                return `
                    <div class="border rounded p-3 ${station.verified ? 'border-green-200 bg-green-50' : 'border-orange-200 bg-orange-50'}">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-medium">${stationName}</div>
                                <div class="text-sm text-gray-600">${station.type} ‚Ä¢ ${city}</div>
                                <div class="text-xs text-gray-500">üìç ${station.lat.toFixed(6)}, ${station.lng.toFixed(6)}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs ${station.verified ? 'text-green-600' : 'text-orange-600'}">
                                    ${station.verified ? '‚úÖ Verified' : 'üìç Estimated'}
                                </div>
                                <a href="https://www.google.com/maps?q=${station.lat},${station.lng}" 
                                   target="_blank" 
                                   class="text-blue-600 hover:text-blue-800 text-xs">
                                    üó∫Ô∏è Check
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('sample-results').innerHTML = html;
        }
    </script>
</body>
</html>